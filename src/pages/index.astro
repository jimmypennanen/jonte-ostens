---
import MainLayout from '../layouts/MainLayout.astro';
import Hero from '../components/Hero.astro';
import CheeseCard from '../components/CheeseCard.astro';
import Testimonial from '../components/Testimonial.astro';
import { getCheeses, getApprovedTestimonials, getCurrentWeeklyCheese } from '../db/index';

export const prerender = false;

const allCheeses = getCheeses();
const featuredCheeses = allCheeses.slice(0, 3);
const testimonials = getApprovedTestimonials();
const currentWeeklyCheese = getCurrentWeeklyCheese();
---

<MainLayout title="Hem">
  <!-- Hero -->
  <Hero
    title="Jontes Ostbutik"
    subtitle="Ost s√• bra att du b√∂rjar ljuga f√∂r familjen ‚Äî En hyllning till Jonte Osten, den lokala ostprofeten"
    cta={{ text: 'Visa ostarna', href: '#featured' }}
  />

  <!-- Veckans ost teaser -->
  <section class="section-padding bg-white">
    <div class="max-w-7xl mx-auto px-6 md:px-8">
      {currentWeeklyCheese ? (
        <div class="card bg-gradient-to-br from-soft-yellow/50 to-light-green/50 border border-soft-yellow">
          <div class="md:flex items-center justify-between">
            <div>
              <h2 class="mb-2">üåü Veckans Ost</h2>
              <p class="text-dark-brown/80 mb-4 md:mb-0">
                <strong>{currentWeeklyCheese.cheese_name}</strong> ‚Äî {currentWeeklyCheese.description}
              </p>
            </div>
            <a href="/veckans-ost" class="btn-secondary whitespace-nowrap">
              L√§s mer
            </a>
          </div>
        </div>
      ) : (
        <div class="card bg-gradient-to-br from-soft-yellow/50 to-light-green/50 border border-soft-yellow">
          <div class="md:flex items-center justify-between">
            <div>
              <h2 class="mb-2">üåü Veckans Ost</h2>
              <p class="text-dark-brown/80 mb-4 md:mb-0">
                Ingen ost vald denna vecka. Kontakta Jonte f√∂r att v√§lja denna veckas specialitet.
              </p>
            </div>
            <a href="/veckans-ost" class="btn-secondary whitespace-nowrap">
              L√§s mer
            </a>
          </div>
        </div>
      )}
    </div>
  </section>

  <!-- Featured cheeses -->
  <section id="featured" class="section-padding bg-cream">
    <div class="max-w-7xl mx-auto px-6 md:px-8">
      <h2 class="text-center mb-12">Mest √§lskade ostar</h2>
      <div class="grid md:grid-cols-3 gap-8">
        {featuredCheeses.map(cheese => (
          <CheeseCard {...cheese} />
        ))}
      </div>
      <div class="text-center mt-12">
        <a href="/produkterna" class="btn-primary">
          Se alla produkter
        </a>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="section-padding bg-white">
    <div class="max-w-7xl mx-auto px-6 md:px-8">
      <h2 class="text-center mb-12">Vad s√§ger folk om Jonte?</h2>
      <div class="grid md:grid-cols-3 gap-8">
        {testimonials.map(testimonial => (
          <Testimonial {...testimonial} />
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="section-padding bg-dark-green text-cream">
    <div class="max-w-4xl mx-auto px-6 md:px-8 text-center">
      <h2 class="text-cream mb-6">Redo f√∂r en ostupplevelse?</h2>
      <p class="text-lg mb-8 text-cream/90">
        Bes√∂k oss idag och m√∂t Jonte. Han kan vara knapph√§ndig, men hans ostar talar f√∂r sig sj√§lva.
      </p>
      <a href="/kontakt" class="btn-secondary">
        Kontakta oss
      </a>
    </div>
  </section>
</MainLayout>
